# 35 kV/25 MW 级联储能 PCS 电池模型使用说明

## 概述

本项目实现了一个完整的电池系统模型，专门用于模拟 35 kV/25 MW 级联储能 PCS 中的电池模块。该模型基于 312 只串联电芯、容量 314 Ah 的配置，直流母线电压约 500 V 每模块。

## 技术规格

- **系统规模**: 35 kV/25 MW 级联储能 PCS
- **储能时长**: 2 小时系统
- **总能量**: 约 50 MWh
- **电芯配置**: 312 只串联
- **额定容量**: 314 Ah
- **模块电压**: 约 500 V (35 kV/√3 ÷ 40)
- **额定电流**: 420 A
- **过载能力**: 支持 3× 额定电流 (1260 A)

## 核心功能

### 1. 电池状态建模
- **SOC 管理**: 基于库仑计量的精确 SOC 跟踪
- **温度建模**: 一阶热网络模型，考虑 I²R 损耗和对流散热
- **电压计算**: OCV(SOC,T) - I·R(SOC,T) 模型

### 2. 环境适应性
- **温度范围**: 20~40°C 环境温度波动
- **容量影响**: 低温容量衰减，高温轻微提升
- **内阻变化**: 温度相关的内阻模型

### 3. 过载保护
- **过载检测**: 实时监控电流倍率
- **加速老化**: 3× 过载时的额外寿命影响
- **安全预警**: 多级安全状态检查

### 4. 寿命预测
- **日历老化**: 基于时间的容量衰减
- **循环老化**: 基于等效满循环的容量损失
- **健康度评估**: 实时电池健康状态监控

## 使用方法

### 基本初始化

```python
from battery_model import BatteryModel, BatteryModelConfig

# 使用默认配置
battery = BatteryModel(initial_soc=0.8, initial_temperature_c=25.0)

# 或自定义配置
config = BatteryModelConfig(
    rated_capacity_ah=314.0,
    rated_current_a=420.0,
    series_cells=312
)
battery = BatteryModel(config=config, initial_soc=0.5, initial_temperature_c=30.0)
```

### 状态更新

```python
# 连续运行仿真
dt = 1.0  # 1秒步长
ambient_temp = 30.0

for step in range(3600):  # 1小时仿真
    current = 420.0  # 额定电流放电
    battery.update_state(current, dt, ambient_temp)
    
    # 获取当前状态
    voltage = battery.get_voltage()
    soc = battery.state_of_charge
    temp = battery.cell_temperature_c
```

### 状态监控

```python
# 获取完整状态信息
status = battery.get_battery_status()
print(f"SOC: {status['soc']:.1%}")
print(f"电压: {status['voltage_v']:.1f} V")
print(f"温度: {status['cell_temperature_c']:.1f}°C")
print(f"容量衰减: {status['capacity_fade_percent']:.2f}%")

# 检查安全状态
safety = battery.check_safety_limits()
if not safety['is_safe']:
    print("警告:", safety['warnings'])
    print("严重警告:", safety['critical_alerts'])
```

### 寿命预测

```python
# 估算剩余寿命
life_estimate = battery.estimate_remaining_life()
print(f"健康度: {life_estimate['health_percentage']:.1f}%")
print(f"剩余寿命: {life_estimate['remaining_life_years']:.1f} 年")
print(f"剩余循环数: {life_estimate['remaining_cycles']:.0f}")
```

### 恒功率放电仿真

```python
# 模拟恒功率放电
power_w = 500000  # 500 kW
ambient_temp = 30.0
max_duration = 2.0  # 2小时

result = battery.simulate_constant_power_discharge(power_w, ambient_temp, max_duration)

# 分析结果
print(f"放电容量: {result['discharge_capacity_ah']:.1f} Ah")
print(f"放电能量: {result['discharge_energy_wh']:.1f} Wh")
print(f"最大电流: {result['max_current_a']:.1f} A")
print(f"最低电压: {result['min_voltage_v']:.1f} V")
```

## 24小时一充一放工况

模型内置了完整的 24 小时运行仿真功能：

```python
# 运行24小时一充一放仿真
battery.example_daily_profile()

# 查看最终状态
print(f"最终SOC: {battery.state_of_charge:.1%}")
print(f"等效循环数: {battery.equivalent_full_cycles:.1f}")
print(f"容量衰减: {battery.capacity_fade_fraction*100:.3f}%")
```

## 过载工况测试

```python
# 测试3倍过载工况
overload_current = battery.config.rated_current_a * 3.0  # 1260 A

# 运行10分钟过载测试
for i in range(600):  # 10分钟 = 600秒
    battery.update_state(overload_current, 1.0, 30.0)
    
    if i % 60 == 0:  # 每分钟检查状态
        status = battery.get_battery_status()
        safety = battery.check_safety_limits()
        print(f"第{i//60}分钟: SOC={status['soc']:.1%}, 安全={safety['is_safe']}")
```

## 参数配置

### BatteryModelConfig 主要参数

```python
config = BatteryModelConfig(
    # 基本参数
    series_cells=312,                    # 串联电芯数
    rated_capacity_ah=314.0,            # 额定容量 (Ah)
    rated_current_a=420.0,              # 额定电流 (A)
    
    # 电压和内阻
    nominal_voltage_per_cell_v=3.6,     # 单体标称电压 (V)
    base_string_resistance_ohm_25c=0.22, # 25°C下基准内阻 (Ω)
    
    # 温度效应
    low_temp_capacity_loss_per_k_c=0.003,    # 低温容量损失系数
    high_temp_capacity_gain_per_k_c=0.001,   # 高温容量增益系数
    
    # 热模型
    thermal_resistance_k_per_w=3.0e-4,       # 热阻 (K/W)
    thermal_capacity_j_per_k=2.0e6,          # 热容 (J/K)
    
    # 寿命模型
    calendar_fade_per_year_at_25c=0.02,      # 25°C年化日历衰减
    cycle_fade_per_equivalent_full_cycle_base=5.0e-4,  # 基础循环衰减
    overload_extra_multiplier_at_3x=3.0      # 3×过载加速因子
)
```

## 运行测试

项目包含完整的测试脚本：

```bash
# 运行功能测试
python test_battery_model.py

# 运行电池模型示例
python battery_model.py
```

测试将验证：
- 基本功能
- SOC 更新
- 温度影响
- 过载工况
- 寿命预测
- 放电曲线绘制

## 输出文件

测试完成后将生成：
- `battery_discharge_curves.png`: 不同温度下的放电曲线图

## 注意事项

1. **数值稳定性**: 模型包含数值保护机制，防止极端工况下的计算异常
2. **参数校准**: 建议根据实际电池数据调整模型参数
3. **过载保护**: 3× 过载工况会显著加速电池老化
4. **温度管理**: 环境温度波动对电池性能有重要影响
5. **寿命估算**: 寿命预测基于简化模型，实际应用需结合实测数据

## 扩展功能

该模型可进一步扩展：
- 多模块串并联建模
- 更复杂的温度分布模型
- 电池管理系统 (BMS) 集成
- 实时数据接口
- 故障诊断和预警

## 技术支持

如有问题或建议，请参考代码注释或联系开发团队。
